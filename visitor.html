<!DOCTYPE html>
<html>
<head>
  <title>Visitor Registration</title>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body>
  <form id="registrationForm">
    <input type="text" name="name" placeholder="Name" required>
    <input type="text" name="university" placeholder="University" required>
    <input type="text" name="college" placeholder="College" required>
    <input type="tel" name="phone" placeholder="Phone" required>
    <input type="email" name="email" placeholder="Email" required>
    <input type="text" name="serial" id="serial" placeholder="Scan QR Code" required readonly>
    <div id="qrReader" style="width: 300px"></div>
    <button type="submit">Register</button>
  </form>

  <script>
    const qrScanner = new Html5Qrcode("qrReader");
    
    // Start QR Scanner
    qrScanner.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      (qrCode) => {
        document.getElementById('serial').value = qrCode;
        qrScanner.stop();
      },
      (error) => console.error(error)
    ).catch(err => console.error(err));

    document.getElementById('registrationForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      
      const response = await fetch('https://script.google.com/macros/s/AKfycbzViYJSyJemchSq4Cr0dSP4uEN6MI4oZgkakqB9p1cVdTi3_5aEt8dkOKxtgloUUZjW/exec', {
        method: 'POST',
        body: JSON.stringify({
          type: 'registration',
          serial: formData.get('serial'),
          name: formData.get('name'),
          university: formData.get('university'),
          college: formData.get('college'),
          phone: formData.get('phone'),
          email: formData.get('email')
        })
      });
      
      const result = await response.json();
      if (result.status === 'success') {
        alert('Registration successful!');
        window.location.reload();
      }
    });
  </script>
</body>
</html>
